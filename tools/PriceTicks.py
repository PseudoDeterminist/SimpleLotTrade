import re
import os
import numpy as np
import matplotlib.pyplot as plt

import math

N = 464
priceTicks = []
print('"""')
print()
print("""The following are our decimal price ticks from 1,000 to just under 10,000. The curve continues
indefinitely. To get higher (or lower) ranges, just multiply each tick by a power of 10.
This curve is exponential but approximated to 4-digit precision. priceTicks are 
approximately 0.5 percent apart at all scales.
""")

for i in range(N):
    x = 10 ** (i / N)
    n = int(x * 1000 + 0.5)
    priceTicks.append(n)
    print(n," ", end='')
    if (i + 1) % 16 == 0:
        print()
   
print("""
The last two digits of each of the following ratios show how close we are to 0.5 percent steps.
We are ranging from 0.43 percent to 0.57 percent. The tradeoff is that we get a simple representation
that fits in 928 bytes (29 uint32 words) instead of a more precise curve that would take more space,
and we also get human readable 4-digit decimal price ticks without any dust.
""")

for i in range(N):
    priceTicks.append(priceTicks[i]*10) # we're goint to plot the curve over two decades later
    print(priceTicks[i]*10)

for i in range(N):
    print(int(priceTicks[i+1]*10000/priceTicks[i]), end=' ')
    if (i + 1) % 16 == 0:
        print()

print()
print("""Here is the solidity hex string encoding of our 464 uint16 mantissas from the decimal price
ticks. This will be stored in the smart contract as a constant byte array.

bytes internal constant MANT =
""", end='')

print('    hex"', end='')
for i in range(N):
    print(format(priceTicks[i], "04x"), end='')
    if (i + 1) % 16 == 0 and i != N - 1:
        print('"')
        print('    hex"', end='')
print('"')

print()

# This program generates the following output:

"""

The following are our decimal price ticks from 1,000 to just under 10,000. The curve continues
indefinitely. To get higher (or lower) ranges, just multiply each tick by a power of 10.
This curve is exponential but approximated to 4-digit precision. priceTicks are
approximately 0.5 percent apart at all scales.

1000  1005  1010  1015  1020  1025  1030  1035  1040  1046  1051  1056  1061  1067  1072  1077
1083  1088  1093  1099  1104  1110  1115  1121  1126  1132  1138  1143  1149  1155  1161  1166
1172  1178  1184  1190  1196  1202  1208  1214  1220  1226  1232  1238  1244  1250  1256  1263
1269  1275  1282  1288  1294  1301  1307  1314  1320  1327  1334  1340  1347  1354  1360  1367
1374  1381  1388  1394  1401  1408  1415  1422  1429  1437  1444  1451  1458  1465  1473  1480
1487  1495  1502  1510  1517  1525  1532  1540  1548  1555  1563  1571  1579  1586  1594  1602
1610  1618  1626  1634  1643  1651  1659  1667  1675  1684  1692  1701  1709  1718  1726  1735
1743  1752  1761  1769  1778  1787  1796  1805  1814  1823  1832  1841  1850  1860  1869  1878
1887  1897  1906  1916  1925  1935  1944  1954  1964  1974  1983  1993  2003  2013  2023  2033
2043  2054  2064  2074  2084  2095  2105  2116  2126  2137  2147  2158  2169  2180  2190  2201
2212  2223  2234  2245  2257  2268  2279  2290  2302  2313  2325  2336  2348  2360  2371  2383
2395  2407  2419  2431  2443  2455  2467  2480  2492  2504  2517  2529  2542  2555  2567  2580
2593  2606  2619  2632  2645  2658  2671  2685  2698  2711  2725  2738  2752  2766  2779  2793
2807  2821  2835  2849  2863  2878  2892  2906  2921  2935  2950  2965  2979  2994  3009  3024
3039  3054  3070  3085  3100  3116  3131  3147  3162  3178  3194  3210  3226  3242  3258  3274
3290  3307  3323  3340  3356  3373  3390  3407  3424  3441  3458  3475  3492  3510  3527  3545
3562  3580  3598  3616  3634  3652  3670  3688  3707  3725  3743  3762  3781  3800  3819  3838
3857  3876  3895  3914  3934  3954  3973  3993  4013  4033  4053  4073  4093  4114  4134  4155
4175  4196  4217  4238  4259  4280  4302  4323  4344  4366  4388  4410  4432  4454  4476  4498
4520  4543  4565  4588  4611  4634  4657  4680  4703  4727  4750  4774  4798  4822  4846  4870
4894  4918  4943  4967  4992  5017  5042  5067  5092  5117  5143  5168  5194  5220  5246  5272
5298  5325  5351  5378  5405  5431  5458  5486  5513  5540  5568  5596  5623  5651  5680  5708
5736  5765  5793  5822  5851  5880  5910  5939  5968  5998  6028  6058  6088  6118  6149  6179
6210  6241  6272  6303  6335  6366  6398  6430  6462  6494  6526  6559  6591  6624  6657  6690
6723  6757  6790  6824  6858  6892  6927  6961  6996  7030  7065  7101  7136  7171  7207  7243
7279  7315  7352  7388  7425  7462  7499  7536  7574  7611  7649  7687  7726  7764  7803  7841
7880  7920  7959  7999  8038  8078  8119  8159  8200  8240  8281  8323  8364  8406  8447  8489
8532  8574  8617  8660  8703  8746  8790  8833  8877  8921  8966  9010  9055  9100  9145  9191
9237  9283  9329  9375  9422  9469  9516  9563  9611  9659  9707  9755  9803  9852  9901  9950

The last two digits of each of the following ratios show how close we are to 0.5 percent steps.
We are ranging from 0.43 percent to 0.57 percent. The tradeoff is that we get a simple representation
that fits in 928 bytes (29 uint32 words) instead of a more precise curve that would take more space,
and we also get human readable 4-digit decimal price ticks without any dust.

10050 10049 10049 10049 10049 10048 10048 10048 10057 10047 10047 10047 10056 10046 10046 10055
10046 10045 10054 10045 10054 10045 10053 10044 10053 10053 10043 10052 10052 10051 10043 10051
10051 10050 10050 10050 10050 10049 10049 10049 10049 10048 10048 10048 10048 10048 10055 10047
10047 10054 10046 10046 10054 10046 10053 10045 10053 10052 10044 10052 10051 10044 10051 10051
10050 10050 10043 10050 10049 10049 10049 10049 10055 10048 10048 10048 10048 10054 10047 10047
10053 10046 10053 10046 10052 10045 10052 10051 10045 10051 10051 10050 10044 10050 10050 10049
10049 10049 10049 10055 10048 10048 10048 10047 10053 10047 10053 10047 10052 10046 10052 10046
10051 10051 10045 10050 10050 10050 10050 10049 10049 10049 10049 10048 10054 10048 10048 10047
10052 10047 10052 10046 10051 10046 10051 10051 10050 10045 10050 10050 10049 10049 10049 10049
10053 10048 10048 10048 10052 10047 10052 10047 10051 10046 10051 10050 10050 10045 10050 10049
10049 10049 10049 10053 10048 10048 10048 10052 10047 10051 10047 10051 10051 10046 10050 10050
10050 10049 10049 10049 10049 10048 10052 10048 10048 10051 10047 10051 10051 10046 10050 10050
10050 10049 10049 10049 10049 10048 10052 10048 10048 10051 10047 10051 10050 10046 10050 10050
10049 10049 10049 10049 10052 10048 10048 10051 10047 10051 10050 10047 10050 10050 10049 10049
10049 10052 10048 10048 10051 10048 10051 10047 10050 10050 10050 10049 10049 10049 10049 10048
10051 10048 10051 10047 10050 10050 10050 10049 10049 10049 10049 10048 10051 10048 10051 10047
10050 10050 10050 10049 10049 10049 10049 10051 10048 10048 10050 10050 10050 10050 10049 10049
10049 10049 10048 10051 10050 10048 10050 10050 10049 10049 10049 10049 10051 10048 10050 10048
10050 10050 10049 10049 10049 10051 10048 10048 10050 10050 10050 10049 10049 10049 10049 10048
10050 10048 10050 10050 10049 10049 10049 10049 10051 10048 10050 10050 10050 10049 10049 10049
10049 10050 10048 10050 10050 10049 10049 10049 10049 10050 10048 10050 10050 10049 10049 10049
10050 10048 10050 10050 10048 10049 10051 10049 10048 10050 10050 10048 10049 10051 10049 10049
10050 10048 10050 10049 10049 10051 10049 10048 10050 10050 10049 10049 10049 10050 10048 10050
10049 10049 10049 10050 10048 10050 10050 10049 10049 10049 10050 10048 10050 10049 10049 10049
10050 10048 10050 10049 10049 10050 10049 10050 10048 10049 10050 10049 10049 10050 10049 10049
10049 10050 10048 10050 10049 10049 10049 10050 10048 10049 10049 10050 10049 10050 10048 10049
10050 10049 10050 10048 10049 10050 10049 10050 10048 10049 10050 10049 10050 10048 10049 10050
10049 10050 10049 10049 10049 10050 10048 10049 10049 10050 10049 10049 10049 10049 10050 10050
10049 10049 10049 10050 10049 10049 10049 10050 10049 10049 10049 10049 10049 10049 10049 10050

Here is the solidity hex string encoding of our 464 uint16 mantissas from the decimal price
ticks. This will be stored in the smart contract as a constant byte array.

bytes internal constant MANT =
    hex"03e803ed03f203f703fc04010406040b04100416041b04200425042b04300435"
    hex"043b04400445044b04500456045b04610466046c04720477047d04830489048e"
    hex"0494049a04a004a604ac04b204b804be04c404ca04d004d604dc04e204e804ef"
    hex"04f504fb05020508050e0515051b05220528052f0536053c0543054a05500557"
    hex"055e0565056c0572057905800587058e0595059d05a405ab05b205b905c105c8"
    hex"05cf05d705de05e605ed05f505fc0604060c0613061b0623062b0632063a0642"
    hex"064a0652065a0662066b0673067b0683068b0694069c06a506ad06b606be06c7"
    hex"06cf06d806e106e906f206fb0704070d0716071f07280731073a0744074d0756"
    hex"075f07690772077c0785078f079807a207ac07b607bf07c907d307dd07e707f1"
    hex"07fb08060810081a0824082f08390844084e08590863086e08790884088e0899"
    hex"08a408af08ba08c508d108dc08e708f208fe090909150920092c09380943094f"
    hex"095b09670973097f098b099709a309b009bc09c809d509e109ee09fb0a070a14"
    hex"0a210a2e0a3b0a480a550a620a6f0a7d0a8a0a970aa50ab20ac00ace0adb0ae9"
    hex"0af70b050b130b210b2f0b3e0b4c0b5a0b690b770b860b950ba30bb20bc10bd0"
    hex"0bdf0bee0bfe0c0d0c1c0c2c0c3b0c4b0c5a0c6a0c7a0c8a0c9a0caa0cba0cca"
    hex"0cda0ceb0cfb0d0c0d1c0d2d0d3e0d4f0d600d710d820d930da40db60dc70dd9"
    hex"0dea0dfc0e0e0e200e320e440e560e680e7b0e8d0e9f0eb20ec50ed80eeb0efe"
    hex"0f110f240f370f4a0f5e0f720f850f990fad0fc10fd50fe90ffd10121026103b"
    hex"104f10641079108e10a310b810ce10e310f8110e1124113a11501166117c1192"
    hex"11a811bf11d511ec1203121a12311248125f1277128e12a612be12d612ee1306"
    hex"131e1336134f13671380139913b213cb13e413fd14171430144a1464147e1498"
    hex"14b214cd14e71502151d15371552156e158915a415c015dc15f716131630164c"
    hex"1668168516a116be16db16f8171617331750176e178c17aa17c817e618051823"
    hex"184218611880189f18bf18de18fe191e193e195e197e199f19bf19e01a011a22"
    hex"1a431a651a861aa81aca1aec1b0f1b311b541b761b991bbd1be01c031c271c4b"
    hex"1c6f1c931cb81cdc1d011d261d4b1d701d961dbb1de11e071e2e1e541e7b1ea1"
    hex"1ec81ef01f171f3f1f661f8e1fb71fdf200820302059208320ac20d620ff2129"
    hex"2154217e21a921d421ff222a2256228122ad22d923062332235f238c23b923e7"
    hex"241524432471249f24ce24fd252c255b258b25bb25eb261b264b267c26ad26de"

"""

# Plot 464x1000 px, no labels
y = np.array(priceTicks, dtype=float)
x = np.arange(len(y))
fig = plt.figure(figsize=(9.28, 10), dpi=10)  # 464 x 1000 px
ax = fig.add_axes([0, 0, 1, 1])
ax.plot(x, y)
ax.set_axis_off()
os.makedirs("assets", exist_ok=True)
out = "assets/PriceCurve.png"
fig.savefig(out, dpi=50)
plt.close(fig)
print("OK: plotted", len(priceTicks), "priceTicks, wrote", out)

